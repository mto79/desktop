#!/usr/bin/env bash

set -e

echo -e "\e[32mUpdate Firmware\e[0m"

if desktop-cmd-present fwupdmgr; then
  fwupdmgr refresh --force &>/dev/null
  if fwupdmgr get-updates 2>/dev/null | grep -qiE 'update available|upgrade available'; then
    sudo fwupdmgr update --assume-yes --no-reboot-check
    # Assume a reboot is required after firmware updates
    desktop-state set reboot-required
  else
    echo -e "Nothing to do.\n"
  fi
else
  echo "fwupdmgr not found, skipping"
fi
