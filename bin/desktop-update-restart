#!/usr/bin/env bash

STATE_DIR=$HOME/.local/state/desktop

if [ -f "$STATE_DIR/reboot-required" ]; then
  gum confirm "Updates require reboot. Ready?" && desktop-state clear re*-required && sudo reboot now
elif [ -f "$STATE_DIR/relaunch-required" ]; then
  gum confirm "Updates require Hyprland relaunch. Ready?" && desktop-state clear relaunch-required && uwsm stop
fi

for file in "$HOME"/.local/state/desktop/restart-*-required; do
  if [ -f "$file" ]; then
    filename=$(basename "$file")
    service=$(echo "$filename" | sed 's/restart-\(.*\)-required/\1/')
    echo "Restarting $service"
    desktop-state clear "$filename"
    desktop-restart-"$service"
  fi
done
